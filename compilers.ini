# -*- encoding: utf-8 -*-

# Copyright 2013 Zack Weinberg <zackw@panix.com> and other contributors.
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
# http://www.apache.org/licenses/LICENSE-2.0
# There is NO WARRANTY.

# This config file specifies how to identify the compiler in use,
# how to invoke it, how to put it into a strictly standards-compliant
# mode, and how to interpret certain things in its output.

[DEFAULTS]
# These are good for any Unixy compiler (with exceptions as noted below)
compile     = -S -o $.s
compile_out = $.s
preproc     = -E -o $.i
preproc_out = $.i

[gcc]
imitated  = yes
id_macro  = __GNUC__

# Under some conditions the string "gcc" does not appear anywhere in
# gcc's --version output, so look instead for the "Copyright YYYY
# Free Software Foundation" blurb.
id_regexp =
  ^\S+\s+(?:\((?P<details>[^)]+)\))?\s+(?P<version>[0-9.]+)\n
  Copyright\ .*\ Free\ Software\ Foundation\b

# Note: same as clang
version  = --version
conform  = -pedantic -Wall -Wextra -Werror -Wno-unknown-pragmas
           -Wno-deprecated-declarations
c1989    = -std=c89
c1999    = -std=c99
c2011    = -std=c11

[clang]
id_macro  = __clang__
id_regexp = (?:\bclang\ version\ (?P<version1>[0-9.-]+)|
               \bLLVM (?P<version2>[0-9.-]+))
            .*?
            Target:\s+(?P<details>[a-zA-Z0-9_-]+)

# Note: same as GCC
version  = --version
conform  = -pedantic -Wall -Wextra -Werror -Wno-unknown-pragmas
           -Wno-deprecated-declarations
c1989    = -std=c89
c1999    = -std=c99
c2011    = -std=c11

[msvc]
id_macro  = _MSC_VER
id_regexp = ^Microsoft .* Compiler\ Version\ (?P<version>[0-9.-]+)

preproc     = /nologo /P
preproc_out = $.i
compile     = /nologo /c
compile_out = $.obj

version  = /c $.c
conform  = /Za /W4 /Wall /WX /WL
c1989    =
c1999    = no
c2011    = no
